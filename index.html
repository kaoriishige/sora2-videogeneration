<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sora Video Generation Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: auto; background-color: #f4f4f9; }
        h1 { color: #333; }
        label { display: block; margin-top: 10px; font-weight: bold; }
        input[type="text"], textarea { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        button { background-color: #007bff; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; margin-top: 20px; font-size: 16px; }
        button:disabled { background-color: #ccc; cursor: not-allowed; }
        #status, #result { margin-top: 20px; padding: 15px; border-radius: 4px; }
        #status { background-color: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
        #result { background-color: #e2e3e5; border: 1px solid #ccc; }
        .success { background-color: #d4edda !important; color: #155724 !important; border-color: #c3e6cb !important; }
        .error { background-color: #f8d7da !important; color: #721c24 !important; border-color: #f5c6cb !important; }
    </style>
</head>
<body>

    <h1>ğŸ¬ Sora Video Generation (Netlify Function Test)</h1>

    <div id="status">ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¦ãã ã•ã„ã€‚</div>

    <form id="videoForm">
        <label for="prompt">ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ (ç”Ÿæˆã—ãŸã„å‹•ç”»ã®èª¬æ˜):</label>
        <textarea id="prompt" rows="4" required placeholder="ä¾‹: æ—¥æœ¬åº­åœ’ã®æ± ã§å„ªé›…ã«æ³³ãé‡‘é­šã€é«˜ç”»è³ªã€ã‚·ãƒãƒãƒ†ã‚£ãƒƒã‚¯"></textarea>

        <label for="callbackUrl">ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯URL (è‡ªå‹•å…¥åŠ›):</label>
        <input type="text" id="callbackUrl" readonly>
        
        <button type="submit" id="submitButton">å‹•ç”»ç”Ÿæˆã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆ</button>
    </form>

    <h2>çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢</h2>
    <div id="result">
        <p>ã“ã“ã«ç”Ÿæˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã®IDã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€æœ€çµ‚çš„ãªå‹•ç”»URLãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('videoForm');
            const promptInput = document.getElementById('prompt');
            const statusDiv = document.getElementById('status');
            const resultDiv = document.getElementById('result');
            const submitButton = document.getElementById('submitButton');
            const callbackUrlInput = document.getElementById('callbackUrl');

            // ğŸ’¡ ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯URLã‚’è‡ªå‹•è¨­å®š
            // ç¾åœ¨ã®ãƒ›ã‚¹ãƒˆåã‚’ä½¿ç”¨ã—ã¦ã€sora_callback Function ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’æ§‹ç¯‰
            const hostname = window.location.hostname;
            const callbackEndpoint = `https://${hostname}/.netlify/functions/sora_callback`;
            callbackUrlInput.value = callbackEndpoint;


            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                statusDiv.className = '';
                statusDiv.textContent = 'ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ä¸­... ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„ã€‚';
                submitButton.disabled = true;
                resultDiv.innerHTML = '<p>ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ä¸­ã§ã™...</p>';

                const prompt = promptInput.value;
                const callbackUrl = callbackUrlInput.value;
                
                // ğŸ’¡ generate_video Function ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
                const generateEndpoint = '/.netlify/functions/generate_video'; 

                try {
                    const response = await fetch(generateEndpoint, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            prompt: prompt,
                            callback_url: callbackUrl,
                        }),
                    });

                    const data = await response.json();

                    if (response.ok) {
                        statusDiv.className = 'success';
                        statusDiv.textContent = 'âœ… ãƒªã‚¯ã‚¨ã‚¹ãƒˆæˆåŠŸï¼å‹•ç”»ç”ŸæˆãŒé–‹å§‹ã•ã‚Œã¾ã—ãŸã€‚';
                        resultDiv.innerHTML = `
                            <p><strong>ãƒªã‚¯ã‚¨ã‚¹ãƒˆID:</strong> ${data.request_id}</p>
                            <p><strong>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:</strong> ${data.status}</p>
                            <p>å‹•ç”»ãŒç”Ÿæˆã•ã‚Œã‚‹ã¨ã€ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯URLã‚’é€šã˜ã¦é€šçŸ¥ã•ã‚Œã¾ã™ã€‚</p>
                            <p>ç”Ÿæˆå®Œäº†ã¾ã§æ•°åˆ†ï¼ˆã¾ãŸã¯ãã‚Œä»¥ä¸Šï¼‰ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</p>
                        `;
                    } else {
                        statusDiv.className = 'error';
                        statusDiv.textContent = `âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${data.message || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼'}`;
                        resultDiv.innerHTML = `<p>ã‚¨ãƒ©ãƒ¼è©³ç´°: ${JSON.stringify(data)}</p>`;
                    }

                } catch (error) {
                    statusDiv.className = 'error';
                    statusDiv.textContent = `âŒ é€šä¿¡ã‚¨ãƒ©ãƒ¼: ${error.message}`;
                } finally {
                    submitButton.disabled = false;
                }
            });
        });
    </script>
</body>
</html>